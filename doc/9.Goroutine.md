# Goroutine 的实现

### 背景（go为啥要开发一个goroutine）
- goroutine  管的事情少，开销小，所以一个Golang的程序中可以支持10w级别的Goroutine
- 在Golang的程序中，操作系统级别的线程调度，通常不会做出合适的调度决策。例如在GC时，内存必须要达到一个一致的状态。在Goroutine机制里，Golang可以控制Goroutine的调度，从而在一个合适的时间进行GC。

### Goroutine实现原理
 两种备选方案
 
- (M:1)多个用户态的线程对应一个系统线程，它可以做快速的上下文切换。缺点是不能有效利用多核CPU
- (1:1)一个用户态的线程对应一个系统线程，它可以利用多核机制，但上下文切换需要消耗额外的资源

golang 的选择

- (M:N)Golang采取了一种多对多的方案。M个用户线程对应N个系统线程，缺点增加了`调度器的实现难度`

